<div class="ordem-container">
  <div class="ordem-header">
    <div class="header-left">
      <h2>Nova Ordem de Serviço</h2>
    </div>
    
    <div class="control-panel">
      <button class="btn-primary" (click)="onSubmit()">
        <i class="material-icons">save</i>
        <span>Salvar</span>
      </button>
      <button class="btn-secondary" (click)="onCancel()">
        <i class="material-icons">close</i>
        <span>Cancelar</span>
      </button>
    </div>
  </div>

  <div class="content-grid">
    <div class="form-section">
      <div class="form-row">
        <div class="form-group">
          <label>GLPI</label>
          <input type="number" [(ngModel)]="ordem.glpi" required title="GLPI">
        </div>
        <div class="form-group">
          <label>Fiscal</label>
          <input type="text" [(ngModel)]="ordem.fiscal" required title="Fiscal">
        </div>
        <div class="form-group">
          <label>Local</label>
          <select [(ngModel)]="ordem.local" required title="Local">
            <option value="">Selecione um local</option>
            <option *ngFor="let local of locais" [value]="local">{{local}}</option>
          </select>
        </div>
        <div class="form-group">
          <label>Área Solicitante</label>
          <select [(ngModel)]="ordem.areaSolicitante" required title="Área Solicitante">
            <option value="">Selecione uma área</option>
            <option *ngFor="let area of areasSolicitantes" [value]="area">{{area}}</option>
          </select>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Data Início</label>
          <input type="date" [(ngModel)]="ordem.dataInicio" required title="Data Início">
        </div>
        <div class="form-group">
          <label>Data Fim Prevista</label>
          <input type="date" [(ngModel)]="ordem.dataFim" required title="Data Fim Prevista">
        </div>
      </div>
    </div>

    <div class="form-section">
      <label>Descrição do Serviço</label>
      <textarea [(ngModel)]="ordem.descricaoServico" rows="3" placeholder="Descreva o serviço" required></textarea>
    </div>

    <div class="form-section">
      <div class="section-header">
        <h3>Itens</h3>
        <button class="btn-add" (click)="addItem()">
          <i class="material-icons">add</i>
        </button>
      </div>

      <div class="new-item-form">
        <div class="item-grid">
          <input type="text" [(ngModel)]="newItem.descricao" placeholder="Descrição">
          <select [(ngModel)]="newItem.unidade" title="Unidade">
            <option value="">Unidade</option>
            <option *ngFor="let un of unidades" [value]="un">{{un}}</option>
          </select>
          <input type="number" [(ngModel)]="newItem.quantidade" placeholder="Qtd." min="0">
          <input type="number" [(ngModel)]="newItem.valorUnitario" placeholder="Valor Unit." min="0" step="0.01">
        </div>
      </div>

      <table *ngIf="ordem.itens?.length">
        <thead>
          <tr>
            <th>Descrição</th>
            <th>Unidade</th>
            <th>Qtd.</th>
            <th>Valor Unit.</th>
            <th>Total</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of ordem.itens; let i = index">
            <td>{{item.descricao}}</td>
            <td>{{item.unidade}}</td>
            <td>{{item.quantidade}}</td>
            <td>{{item.valorUnitario | currency:'BRL'}}</td>
            <td>{{item.quantidade * item.valorUnitario | currency:'BRL'}}</td>
            <td>
              <button class="btn-icon delete" (click)="removeItem(i)">
                <i class="material-icons">delete</i>
              </button>
            </td>
          </tr>
        </tbody>
        <tfoot>
          <tr>
            <td colspan="4" class="text-right"><strong>Total:</strong></td>
            <td colspan="2"><strong>{{calcularTotal() | currency:'BRL'}}</strong></td>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>
</div>